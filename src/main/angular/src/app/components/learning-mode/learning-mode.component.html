<div class="learning-mode-container">
  <div class="navigation-bar">
    <div class="left-nav">
      <button class="nav-button" (click)="navigateToWelcome()">切换模式</button>
    </div>
    <div class="right-nav">
      <div class="username-display" *ngIf="currentUsername">
        当前用户: {{ currentUsername }}
      </div>
      <button class="logout-btn" style="background-color: #3498db; color: white;" (click)="to_login()">返回登录界面</button>
      <button class="logout-button" (click)="logout()">退出登录</button>
    </div>
  </div>
  <div class="mode-header">
    <h1>学习模式</h1>
    <p>在这种模式下，您可以学习图灵机的概念和用法，有引导式的教程和案例。</p>
    <button (click)="toggleCreateForm()" class="create-button">
      {{ showCreate ? '取消创建' : '创建新图灵机' }}
    </button>
  </div>

  <!-- 创建新图灵机表单 -->
  <div *ngIf="showCreate" class="create-form">
    <h2>创建新图灵机</h2>
    <div class="form-group">
      <label for="machine-name">名称</label>
      <input type="text" id="machine-name" [(ngModel)]="newMachine.name" placeholder="输入图灵机名称">
    </div>
    <div class="form-group">
      <label for="machine-description">描述</label>
      <textarea id="machine-description" [(ngModel)]="newMachine.description" placeholder="输入图灵机描述（可选）"></textarea>
    </div>
    <div class="form-actions">
      <button (click)="createMachine()" class="submit-button">创建</button>
      <button (click)="toggleCreateForm()" class="cancel-button">取消</button>
    </div>
  </div>

  <!-- 图灵机列表 -->
  <div class="machine-list" *ngIf="machines.length > 0">
    <h2>已有图灵机</h2>
    <div class="machine-grid">
      <div class="machine-card" *ngFor="let machine of machines" (click)="selectMachine(machine)">
        <div *ngIf="editingMachineId !== machine.id">
          <div class="machine-name">{{ machine.name }}</div>
          <div class="machine-description">{{ machine.description || '无描述' }}</div>
          <div class="machine-time">创建时间: {{ machine.createTime | date:'yyyy-MM-dd HH:mm' }}</div>
          <div class="machine-actions">
            <button class="edit-button" (click)="startEditMachine(machine, $event)">重命名</button>
            <button class="delete-button" (click)="deleteMachine(machine.id, $event)">删除</button>
            <button *ngIf="currentUserRole === 'STUDENT'" class="submit-excellent" (click)="submitExcellentAssignment(machine); $event.stopPropagation();">提交为优秀作业</button>
          </div>
        </div>
        <div *ngIf="editingMachineId === machine.id" class="machine-edit" (click)="$event.stopPropagation()">
          <input type="text" [(ngModel)]="editingMachineName" placeholder="输入新名称" class="edit-input" (click)="$event.stopPropagation()">
          <textarea [(ngModel)]="editingMachineDescription" placeholder="输入新描述（可选）" class="edit-textarea" (click)="$event.stopPropagation()"></textarea>
          <div class="edit-actions">
            <button class="save-button" (click)="saveMachineRename(machine.id, $event)">保存</button>
            <button class="cancel-button" (click)="cancelEdit(); $event.stopPropagation();">取消</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 本地展示已提交的优秀作业（仅用于前端快速查看） -->
  <div class="excellent-submissions" *ngIf="excellentSubmissions.length > 0">
    <h3>已提交的优秀作业</h3>
    <ul>
      <li *ngFor="let s of excellentSubmissions">{{ s.name }} - 提交者: {{ s.username }} - {{ s.createTime | date:'yyyy-MM-dd HH:mm' }}</li>
    </ul>
  </div>

  <div class="no-machines" *ngIf="machines.length === 0">
    <p>暂无图灵机，请创建新的图灵机。</p>
  </div>
</div>

<!-- Toast host: 显示本页面的 toast 消息 -->
<app-shared-toast></app-shared-toast>

<!-- 在 router-outlet 中显示选中的图灵机 -->
<router-outlet></router-outlet>
