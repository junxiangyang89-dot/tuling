<div class="challenge-mode-container">
    <div class="navigation-bar">
      <div class="left-nav">
        <button class="nav-button" (click)="navigateToWelcome()">切换模式</button>
      </div>
      <h1 class="mode-title">挑战模式</h1>
      <div class="right-nav">
        <div class="username-display" *ngIf="currentUsername">
          当前用户: {{ currentUsername }}
        </div>
        <button class="logout-btn" style="background-color: #3498db; color: white;" (click)="to_login()">返回登录界面</button>
        <button class="logout-button" (click)="logout()">退出登录</button>
      </div>
    </div>

    <div class="mode-header">
      <p class="intro">
        欢迎进入挑战模式！请选择一道挑战题目，通过编写图灵机规则完成任务。
      </p>
      <div class="selection-box">
        <label for="test-select">选择题目：</label>
        <select id="test-select" [(ngModel)]="selectedTestId">
          <option [ngValue]="null" disabled selected>-- 请选择 --</option>
          <option *ngFor="let test of testCases" [ngValue]="test.id">
            {{ test.title }}
          </option>
        </select>

        <button (click)="createMachine()" [disabled]="!selectedTestId">
          进入
        </button>
      </div>
    </div>

    <!-- 学生提交题目表单（可选） -->
    <div class="submit-box" *ngIf="!isTeacher">
      <h3>提交优秀题目（学生）</h3>
      <div>
        <label>题目标题</label>
        <input [(ngModel)]="newMachine.name" placeholder="题目名称" />
      </div>
      <div>
        <label>题目描述</label>
        <textarea [(ngModel)]="newMachine.description" rows="3"></textarea>
      </div>
      <div>
        <label>测试用例（JSON）</label>
        <textarea [(ngModel)]="newMachine.testcase" rows="3" placeholder='{"input":"...","output":"..."}'></textarea>
      </div>
      <button (click)="submitChallenge()">提交题目（等待教师审核）</button>
    </div>

    <!-- 教师待审列表 -->
    <div class="admin-review" *ngIf="isTeacher">
      <h3>待审核题目</h3>
      <div *ngIf="pendingTestCases.length === 0">暂无待审题目</div>
      <div *ngFor="let q of pendingTestCases" class="pending-card">
        <div class="pending-title">{{ q.title }}</div>
        <div class="pending-desc">{{ q.description }}</div>
        <div class="pending-actions">
          <button (click)="approveQuestion(q)">通过并发布</button>
          <button (click)="deleteQuestion(q)">删除</button>
        </div>
      </div>
    </div>

  <!-- 图灵机列表 -->
  <div class="machine-list" *ngIf="machines.length > 0">
    <h2>已有图灵机</h2>
    <div class="machine-grid">
      <div class="machine-card" *ngFor="let machine of machines" (click)="selectMachine(machine)">
        <div class="machine-name">{{ machine.name }}</div>
        <div class="machine-description">{{ machine.description || '无描述' }}</div>
        <div class="machine-time">创建时间: {{ machine.createTime | date:'yyyy-MM-dd HH:mm' }}</div>
<!--        <button class="delete-button" (click)="deleteMachine(machine.id, $event)">删除</button>-->
      </div>
    </div>
  </div>

  <div class="no-machines" *ngIf="machines.length === 0">
    <p>暂无图灵机，请创建新的图灵机。</p>
  </div>
</div>

  <!-- 在 router-outlet 中显示选中的图灵机 -->
  <router-outlet></router-outlet>
