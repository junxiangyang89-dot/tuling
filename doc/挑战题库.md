# 挑战题库（Challenge Question）说明

## 数据库表 (MySQL)

请在项目数据库中创建以下表：

```sql
CREATE TABLE `challenge_question` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `title` VARCHAR(255) NOT NULL,
  `description` TEXT,
  `testcase_json` TEXT,
  `creator_user_id` BIGINT,
  `creator_username` VARCHAR(100),
  `status` VARCHAR(20) DEFAULT 'PENDING' COMMENT 'PENDING/APPROVED/REJECTED',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

## 后端 API

- GET /api/challenge/questions
  - 返回所有 `APPROVED` 状态的题目（供学生/游客使用）
- GET /api/challenge/admin/questions
  - 仅供教师查看，返回所有题目（含 PENDING）
- POST /api/challenge/submit
  - 学生提交题目（进入 PENDING），请求体：{ title, description, testcaseJson }
- PUT /api/challenge/{id}/approve
  - 教师审批通过（设置 status=APPROVED）
- DELETE /api/challenge/{id}
  - 教师删除题目

注意：服务端严格基于数据库中的 `User.role` 字段作为权限依据；前端可显示当前用户角色但不作为权限唯一来源。

## 前端

- 挑战模式页面现在会从后端加载题目列表（已审批的题目）。学生可以提交新题目，教师可以在待审区进行审批或删除。

- 兼容历史数据：项目中原有的本地静态题目（`src/main/angular/src/app/data/challenge.ts` 中定义的 `CHALLENGE_TESTCASES`）仍会保留并与后端已审批题目合并展示，后端题目若与本地题目同名会覆盖本地显示，确保不会丢失之前的题目资源。

## 使用流程（推荐）

1. 学生在挑战模式页面提交题目，进入 PENDING 状态。
2. 教师登录并打开挑战模式的教师视图，查看待审题目。
3. 教师通过后，该题目状态变为 APPROVED，所有学生即可在题库中看到。

